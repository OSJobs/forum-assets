define("discourse/routes/application",["exports","@ember/runloop","discourse/routes/discourse","discourse/lib/ajax","discourse/lib/computed","discourse/lib/logout","discourse/lib/show-modal","discourse/mixins/open-composer","discourse/models/category","discourse/lib/mobile","discourse/models/login-method","discourse-common/lib/get-owner","discourse/lib/url","discourse/models/composer"],function(e,o,t,i,n,r,s,l,a,c,d,u,h,p){"use strict";function g(e,o){return function(){this.site.get("isReadOnly")?bootbox.alert(o):this[e]()}}Object.defineProperty(e,"__esModule",{value:!0});var f=t.default.extend(l.default,{siteTitle:(0,n.setting)("title"),shortSiteDescription:(0,n.setting)("short_site_description"),actions:{toggleAnonymous:function(){(0,i.ajax)((0,h.userPath)("toggle-anon"),{type:"POST"}).then(function(){window.location.reload()})},toggleMobileView:function(){c.default.toggleMobileView()},logout:g("_handleLogout",I18n.t("read_only_mode.logout_disabled")),_collectTitleTokens:function(e){e.push(this.siteTitle),window.location.pathname!==Discourse.getURL("/")&&window.location.pathname!==Discourse.getURL("/login")||""===this.shortSiteDescription||e.push(this.shortSiteDescription),Discourse.set("_docTitle",e.join(" - "))},willTransition:function(){var e=(0,u.getOwner)(this).lookup("router:main");return(0,o.once)(e,e.trigger,"willTransition"),this._super.apply(this,arguments)},postWasEnqueued:function(e){(0,s.default)("post-enqueued",{model:e,title:"review.approval.title"})},composePrivateMessage:function(e,o){var t=e?e.get("username"):"",i=o?window.location.protocol+"//"+window.location.host+o.url:null,n=o?I18n.t("composer.reference_topic_title",{title:o.topic.title}):null;return this.controllerFor("composer").open({action:p.default.PRIVATE_MESSAGE,recipients:t,archetypeId:"private_message",draftKey:p.default.NEW_PRIVATE_MESSAGE_KEY,draftSequence:0,reply:i,title:n})},error:function(e,o){var t={};e.jqXHR&&(t=e.jqXHR);var i=e.jqXHR?t:e,n=this.controllerFor("exception"),r=window.console;return r&&r.error&&r.error(i),i&&404===i.status?this.transitionTo("exception-unknown"):(n.setProperties({lastTransition:o,thrown:i}),this.intermediateTransitionTo("exception"),!0)},showLogin:g("handleShowLogin",I18n.t("read_only_mode.login_disabled")),showCreateAccount:g("handleShowCreateAccount",I18n.t("read_only_mode.login_disabled")),showForgotPassword:function(){this.controllerFor("forgot-password").setProperties({offerHelp:null,helpSeen:!1}),(0,s.default)("forgotPassword",{title:"forgot_password.title"})},showNotActivated:function(e){(0,s.default)("not-activated",{title:"log_in"}).setProperties(e)},showUploadSelector:function(e){(0,s.default)("uploadSelector").setProperties({toolbarEvent:e,imageUrl:null})},showKeyboardShortcutsHelp:function(){(0,s.default)("keyboard-shortcuts-help",{title:"keyboard_shortcuts_help.title"})},closeModal:function(e){var o=(0,u.getOwner)(this).lookup("route:application").controllerFor("modal"),t=o.get("name");if(t){var i=(0,u.getOwner)(this).lookup("controller:"+t);if(i&&i.beforeClose&&!1===i.beforeClose())return}if(this.render("hide-modal",{into:"modal",outlet:"modalBody"}),t){var n=(0,u.getOwner)(this).lookup("controller:"+t);n&&n.onClose&&n.onClose({initiatedByCloseButton:"initiatedByCloseButton"===e,initiatedByClickOut:"initiatedByClickOut"===e}),o.set("name",null)}},hideModal:function(){$(".d-modal.fixed-modal").modal("hide")},reopenModal:function(){$(".d-modal.fixed-modal").modal("show")},editCategory:function(e){var t=this;a.default.reloadById(e.get("id")).then(function(e){var o=t.store.createRecord("category",e.category);o.setupGroupsAndPermissions(),t.site.updateCategory(o),(0,s.default)("edit-category",{model:o}),t.controllerFor("edit-category").set("selectedTab","general")})},checkEmail:function(e){e.checkEmail()},changeBulkTemplate:function(e){var o=e.replace("modal/",""),t=(0,u.getOwner)(this).lookup("controller:"+o);this.render(e,{into:"modal/topic-bulk-actions",outlet:"bulkOutlet",controller:t?o:"topic-bulk-actions"})},createNewTopicViaParams:function(e,o,t,i){this.openComposerWithTopicParams(this.controllerFor("discovery/topics"),e,o,t,i)},createNewMessageViaParams:function(e,o,t){this.openComposerWithMessageParams(e,o,t)}},renderTemplate:function(){this.render("application"),this.render("user-card",{into:"application",outlet:"user-card"}),this.render("modal",{into:"application",outlet:"modal"}),this.render("composer",{into:"application",outlet:"composer"})},handleShowLogin:function(){var e=this;if(this.siteSettings.enable_sso){var o=encodeURIComponent(window.location.pathname);window.location=Discourse.getURL("/session/sso?return_path="+o)}else this._autoLogin("login","login-modal",function(){return e.controllerFor("login").resetForm()})},handleShowCreateAccount:function(){if(this.siteSettings.enable_sso){var e=encodeURIComponent(window.location.pathname);window.location=Discourse.getURL("/session/sso?return_path="+e)}else this._autoLogin("createAccount","create-account")},_autoLogin:function(e,o,t){var i=(0,d.findAll)();this.siteSettings.enable_local_logins||1!==i.length?((0,s.default)(e),this.controllerFor("modal").set("modalClass",o),t&&t()):this.controllerFor("login").send("externalLogin",i[0])},_handleLogout:function(){var e=this;this.currentUser&&this.currentUser.destroySession().then(function(){return(0,r.default)(e.siteSettings,e.keyValueStore)})}});e.default=f});
//# sourceMappingURL=/assets/discourse/app/routes/application-388f758905f71c421825760b001e91a23d3f30070f660a81955fcf2453e4d5e1.js.map